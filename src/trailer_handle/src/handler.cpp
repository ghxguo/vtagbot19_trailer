/** \file
* this is the highlevel control code for the trailer
* developed by: Hongxu Guo
* Date: 5-1-19
*
* version: 1.0
*/


#include <ros/ros.h>
#include <std_msgs/String.h>
#include <sstream>
#include <std_msgs/MultiArrayDimension.h>
#include <std_msgs/UInt16MultiArray.h>
#include <std_msgs/UInt8.h>
#include <std_msgs/UInt16.h>
#include <std_msgs/Char.h>
#include <vector>

#define PROFILE1LENGTH  412
#define PROFILE2LENGTH  245
#define PROFILE3LENGTH  402
#define MOTIONTH        25

uint16_t profile1[] =
{
478,514,145,414,281,2865,
478,513,145,414,281,2854,
477,513,145,412,281,2843,
478,513,146,412,281,2854,
478,513,146,412,281,2865,
478,513,154,409,292,2863,
478,513,165,403,302,2854,
478,513,176,398,313,2849,
477,513,188,391,326,2844,
478,513,194,387,337,2840,
478,513,196,378,348,2839,
478,513,201,376,359,2842,
478,513,210,373,370,2844,
478,513,220,367,383,2844,
478,513,229,360,395,2845,
478,513,236,358,406,2845,
478,513,244,349,419,2847,
478,513,250,345,430,2851,
478,513,257,338,442,2854,
478,513,260,332,453,2857,
478,513,265,328,465,2863,
478,513,274,323,477,2871,
478,513,284,318,490,2876,
478,513,292,312,501,2881,
478,513,299,309,513,2887,
478,513,302,303,524,2893,
478,514,310,302,534,2904,
478,513,320,299,545,2908,
478,513,331,298,555,2910,
478,513,342,298,565,2912,
478,513,355,298,576,2913,
478,514,366,298,585,2915,
478,514,377,297,594,2922,
478,514,382,297,600,2933,
478,515,385,293,602,2944,
478,515,385,293,603,2956,
478,515,385,292,603,2967,
478,515,383,292,603,2978,
478,515,380,291,603,2989,
478,515,377,290,603,3000,
478,515,373,287,603,3011,
478,514,370,282,603,3022,
478,515,364,278,603,3033,
478,515,359,275,603,3044,
478,515,358,275,603,3055,
478,514,358,275,603,3066,
478,515,357,273,603,3077,
478,515,349,269,603,3088,
478,514,349,264,616,3093,
478,514,365,263,633,3079,
478,513,387,264,652,3066,
478,513,405,265,669,3065,
478,514,416,265,678,3066,
478,514,419,264,680,3078,
478,515,419,264,680,3090,
478,516,418,263,680,3101,
478,516,418,261,680,3112,
478,516,418,261,682,3124,
478,515,422,261,693,3133,
478,516,434,261,700,3141,
478,516,444,261,707,3152,
478,517,445,261,708,3163,
478,517,445,261,708,3175,
478,519,445,259,709,3186,
478,519,445,257,709,3197,
478,519,445,256,709,3209,
478,520,445,256,709,3220,
478,521,446,254,709,3231,
478,521,441,249,709,3244,
478,521,441,249,709,3257,
478,522,441,249,709,3268,
478,522,441,249,709,3280,
478,524,441,249,709,3291,
478,524,441,249,709,3302,
478,524,441,249,709,3314,
478,524,442,249,709,3326,
478,525,442,249,709,3339,
478,525,443,249,709,3352,
478,525,444,249,709,3365,
478,525,445,249,709,3377,
478,525,445,249,709,3389,
478,525,445,249,709,3400,
478,526,446,249,709,3412,
478,526,446,249,709,3423,
478,526,446,249,709,3434,
478,527,446,248,709,3446,
478,527,446,248,709,3457,
479,528,446,247,709,3468,
478,529,446,245,709,3480,
478,529,446,245,709,3492,
478,529,446,245,709,3503,
478,529,446,245,709,3514,
478,529,446,245,709,3526,
478,529,446,245,709,3538,
478,529,446,245,709,3549,
478,529,446,245,709,3560,
478,529,446,245,709,3571,
478,529,446,245,709,3583,
478,528,446,245,709,3594,
478,528,446,245,709,3605,
478,528,448,245,702,3594,
478,527,437,245,693,3592,
478,524,435,245,693,3603,
478,522,423,245,683,3603,
478,520,412,245,675,3601,
478,519,401,245,666,3602,
478,519,390,245,656,3609,
478,518,383,249,645,3612,
478,518,380,251,634,3611,
478,518,372,254,622,3609,
478,518,364,259,611,3607,
478,518,360,269,600,3608,
478,518,349,269,590,3608,
478,518,337,269,580,3608,
478,518,328,269,569,3607,
478,517,317,267,563,3607,
478,518,306,264,556,3607,
478,518,295,264,549,3607,
478,518,284,264,542,3605,
// change position of clamp
376,513,264,261,532,3604,
376,513,265,262,533,3593,
376,513,270,262,534,3582,
376,513,277,262,546,3580,
376,514,294,262,563,3572,
376,514,308,263,575,3570,
376,514,320,268,583,3573,
376,514,331,269,590,3573,
376,514,340,270,601,3572,
376,514,351,271,608,3571,
376,514,362,275,614,3570,
376,514,373,276,621,3569,
376,514,385,279,629,3569,
376,514,394,282,641,3566,
376,514,405,285,650,3566,
376,514,416,289,656,3566,
376,514,427,293,664,3564,
376,514,438,300,671,3561,
376,514,448,311,675,3561,
376,514,454,322,675,3562,
376,514,465,331,675,3567,
376,514,476,341,675,3568,
376,514,488,352,675,3568,
376,514,499,363,675,3569,
376,514,508,374,675,3570,
376,514,519,381,675,3572,
376,514,530,391,675,3573,
376,514,541,401,675,3576,
376,514,552,411,675,3576,
376,514,562,422,675,3576,
376,514,570,433,675,3577,
376,514,578,444,671,3579,
376,514,584,455,666,3579,
376,514,591,467,661,3581,
376,514,598,478,655,3582,
376,514,606,489,650,3584,
376,514,611,500,646,3584,
376,514,619,511,642,3584,
376,514,626,523,638,3584,
376,514,636,537,631,3584,
376,514,645,550,628,3586,
376,514,656,562,622,3588,
376,514,666,575,619,3591,
376,514,677,588,616,3592,
376,514,685,600,612,3594,
376,514,695,612,610,3596,
376,514,704,623,607,3600,
376,514,712,634,604,3602,
376,514,719,645,602,3604,
376,514,726,657,598,3605,
376,514,735,668,594,3605,
376,514,742,681,590,3606,
376,514,751,692,584,3605,
376,514,757,703,580,3605,
376,514,764,714,575,3605,
376,514,775,727,569,3605,
376,514,780,738,565,3605,
376,514,788,750,560,3605,
376,514,794,762,554,3605,
376,514,798,773,549,3607,
376,514,802,774,549,3596,
376,514,802,774,549,3584,
376,514,802,774,549,3573,
376,514,802,774,549,3562,
376,514,802,774,549,3551,
376,515,802,774,549,3539,
376,514,802,774,549,3527,
376,514,802,774,549,3516,
376,514,802,774,549,3505,
376,514,802,774,549,3494,
376,514,805,774,549,3483,
376,514,806,774,549,3467,
376,514,808,774,550,3452,
376,514,808,774,550,3440,
376,514,808,774,552,3429,
376,513,808,774,554,3415,
376,514,808,774,555,3400,
376,514,808,774,556,3382,
376,514,808,775,556,3362,
376,514,808,775,556,3345,
376,514,808,775,556,3329,
376,514,808,775,556,3316,
376,514,808,775,556,3302,
376,514,808,777,556,3289,
376,514,808,779,556,3271,
376,514,808,782,556,3249,
376,514,808,787,556,3224,
376,514,808,790,556,3195,
376,514,808,795,556,3166,
376,514,808,801,556,3138,
376,514,808,804,556,3105,
376,514,808,806,556,3067,
376,513,808,808,556,3037,
376,514,808,808,556,3026,
376,514,808,809,556,3014,
376,514,808,810,556,2997,
376,514,808,811,556,2975,
376,514,808,814,556,2947,
376,514,808,815,556,2927,
376,514,808,815,556,2906,
376,514,808,815,556,2889,
376,514,808,816,556,2871,
376,514,808,816,556,2857,
376,514,808,816,556,2842,
376,514,808,816,556,2820,
376,514,808,816,556,2796,
376,514,808,816,556,2776,
376,514,808,816,556,2764,
376,514,808,816,556,2753,
376,514,808,816,556,2737,
376,515,808,816,556,2720,
376,514,808,816,556,2702,
376,514,808,816,556,2686,
376,514,808,816,556,2673,
376,514,808,816,556,2656,
376,514,809,816,556,2636,
376,514,808,816,556,2612,
376,514,808,816,556,2590,
376,514,809,816,556,2569,
376,514,809,816,556,2548,
376,514,809,816,556,2529,
376,514,809,816,556,2510,
376,514,809,816,556,2485,
376,514,809,816,556,2459,
376,514,809,817,556,2434,
376,514,809,820,556,2407,
376,514,809,820,556,2382,
376,514,809,820,556,2360,
376,514,809,820,556,2339,
376,514,809,820,556,2324,
376,514,809,820,556,2311,
376,515,809,820,556,2296,
376,514,809,820,556,2278,
376,514,809,820,556,2259,
376,514,809,820,556,2237,
376,514,809,820,556,2215,
376,514,809,820,556,2194,
376,514,809,820,556,2173,
376,514,809,820,556,2151,
376,514,809,820,556,2129,
376,514,809,820,556,2111,
376,514,809,820,556,2093,
376,514,809,820,556,2077,
376,514,809,820,556,2063,
376,514,809,820,556,2049,
376,514,809,820,556,2037,
376,514,809,820,556,2024,
376,514,809,820,556,2008,
376,514,809,820,556,1991,
376,514,809,820,556,1971,
376,514,809,820,556,1952,
376,514,809,820,556,1932,
376,514,809,820,556,1915,
376,514,809,820,556,1899,
376,514,809,820,556,1883,
376,514,809,820,556,1868,
376,514,809,820,556,1852,
376,514,809,820,556,1836,
376,514,809,820,556,1817,
376,514,809,820,556,1796,
376,514,809,820,556,1772,
376,514,809,820,556,1746,
376,514,809,820,556,1722,
376,514,809,820,556,1702,
376,514,809,820,556,1684,
376,514,809,820,556,1670,
376,514,809,820,556,1659,
376,514,809,820,556,1647,
376,514,809,820,556,1635,
376,514,809,817,556,1618,
376,514,809,817,556,1597,
376,514,809,816,556,1574,
376,514,809,816,556,1555,
376,514,809,815,556,1543,
376,514,809,811,556,1532,
376,514,809,811,556,1519,
376,514,809,811,556,1505,
376,514,809,811,556,1488,
376,514,809,811,556,1472,
376,514,809,811,556,1458,
376,514,809,811,556,1447,
376,514,809,811,556,1436,
376,514,809,811,556,1425,
376,514,809,811,556,1414,
376,514,809,811,556,1403,
376,514,809,811,555,1392,
376,514,809,811,555,1380,
376,514,809,811,553,1369,
376,514,809,811,551,1357,
376,514,809,811,549,1343,
376,514,809,811,549,1331,
376,514,809,811,546,1320,
376,514,809,811,535,1314,
376,515,808,800,532,1315,
376,516,808,789,532,1316,
377,516,802,778,532,1322,
377,516,790,773,532,1323,
377,516,777,766,532,1324,
377,515,765,758,532,1325,
377,515,755,747,532,1325,
377,515,745,736,532,1328,
377,516,736,727,532,1339,
377,516,728,720,532,1350,
377,516,726,716,532,1362,
377,516,725,716,532,1373,
377,516,725,714,532,1384,
377,516,717,703,532,1390,
377,517,714,692,532,1387,
376,518,714,681,532,1388,
376,519,712,670,532,1388,
376,518,700,666,532,1389,
376,518,687,655,532,1388,
376,518,674,644,532,1387,
376,518,662,633,532,1385,
376,518,650,621,532,1385,
376,518,637,612,532,1383,
376,517,626,602,533,1381,
376,517,614,591,533,1379,
376,517,603,582,533,1380,
376,517,592,572,533,1380,
376,518,580,565,533,1379,
376,517,569,556,533,1379,
376,518,557,545,533,1380,
376,518,546,537,533,1380,
376,517,535,530,533,1380,
376,517,522,520,533,1380,
376,517,512,509,532,1380,
376,517,501,502,532,1380,
376,516,490,494,532,1389,
376,516,485,488,532,1400,
376,516,475,477,532,1402,
376,516,463,470,532,1400,
376,516,452,459,532,1399,
376,516,442,448,532,1400,
376,516,437,437,532,1400,
376,517,429,426,532,1396,
376,517,418,417,530,1392,
376,518,405,415,524,1391,
376,517,394,413,513,1390,
376,517,381,413,503,1386,
376,517,367,413,493,1383,
376,517,356,413,485,1379,
376,517,345,413,479,1377,
376,517,334,413,470,1373,
376,517,331,413,465,1362,
376,517,332,413,465,1351,
376,517,337,413,458,1340,
376,517,331,414,446,1335,
376,517,320,416,437,1331,
376,517,317,425,426,1325,
376,517,317,434,419,1314,
376,516,319,444,408,1307,
376,516,328,454,397,1298,
376,516,334,462,393,1287,
376,516,334,470,386,1275,
376,517,334,480,375,1266,
376,518,336,489,364,1260,
376,518,332,497,358,1249,
376,518,321,497,356,1241,
377,518,310,497,350,1236,
376,518,299,497,346,1231,
376,517,293,497,339,1220,
377,517,294,497,338,1209,
376,517,296,497,336,1198,
375,517,298,497,336,1187,
377,517,303,497,336,1176,
376,518,314,497,336,1167,
376,518,325,497,336,1163,
376,518,314,497,336,1153,
376,518,303,497,336,1147,
376,517,292,497,335,1141,
376,517,289,497,335,1130,
377,517,295,500,335,1119,
376,517,298,506,333,1108,
376,517,298,516,322,1100,
376,517,298,527,313,1093,
376,518,295,538,305,1088,
376,518,294,550,298,1082,
376,518,292,562,289,1078,
376,519,290,573,284,1075,
376,519,287,584,277,1072,
376,520,298,591,271,1065,
376,524,309,591,275,1056,
376,524,320,590,280,1049,
376,524,331,590,285,1042,
376,524,342,590,289,1031,
376,525,352,585,295,1020,
376,525,352,573,301,1017,
376,525,343,561,308,1012,
377,525,332,554,310,1002,
376,525,336,551,318,991,
377,530,356,597,300,999,
};

uint16_t profile2[] =
{
  377,530,356,597,300,999,
  377,530,357,597,300,1010,
  377,530,357,597,300,1021,
  377,530,357,597,297,1032,
  377,530,357,597,297,1043,
  377,530,357,597,297,1054,
  377,530,355,597,297,1065,
  377,530,355,597,297,1076,
  377,530,355,597,297,1087,
  377,530,352,597,297,1099,
  377,530,351,597,297,1110,
  377,530,351,597,297,1121,
  377,530,350,597,297,1132,
  377,530,350,597,297,1143,
  377,530,350,597,297,1154,
  377,530,351,597,308,1163,
  377,530,358,597,315,1174,
  377,530,360,597,321,1185,
  377,530,362,597,326,1196,
  377,530,363,597,326,1207,
  377,530,365,597,326,1219,
  377,530,366,597,326,1230,
  377,530,366,597,326,1241,
  377,530,368,597,334,1252,
  377,530,373,597,339,1263,
  377,530,381,597,344,1275,
  377,530,383,597,347,1286,
  377,530,383,597,350,1297,
  377,531,385,597,352,1308,
  376,531,378,597,351,1319,
  377,530,383,596,362,1322,
  377,530,394,596,370,1321,
  377,530,405,596,377,1319,
  377,530,417,596,384,1317,
  377,531,428,596,388,1318,
  377,530,435,597,397,1329,
  377,530,424,597,397,1331,
  377,530,413,597,397,1335,
  377,530,402,597,397,1341,
  377,530,391,597,397,1334,
  377,530,403,597,400,1339,
  377,530,414,597,408,1344,
  377,530,425,597,415,1347,
  377,530,436,597,421,1348,
  377,530,445,597,433,1352,
  377,530,455,597,445,1351,
  377,530,466,597,451,1349,
  377,530,477,597,459,1350,
  377,530,488,596,469,1348,
  377,530,498,593,480,1348,
  377,530,499,582,490,1348,
  377,530,499,573,501,1353,
  377,530,499,566,512,1354,
  377,530,501,557,524,1354,
  377,530,503,546,535,1360,
  377,530,505,538,546,1368,
  377,530,507,531,555,1379,
  377,529,514,530,567,1389,
  377,530,525,530,578,1396,
  377,530,531,530,589,1404,
  377,530,538,530,600,1409,
  377,530,546,530,610,1420,
  377,530,557,530,617,1428,
  377,530,568,530,622,1437,
  377,530,579,530,631,1448,
  377,530,589,530,638,1459,
  377,530,589,530,639,1470,
  377,530,589,530,639,1481,
  377,530,588,530,641,1492,
  377,530,586,530,641,1503,
  377,530,585,530,641,1515,
  377,530,585,530,641,1527,
  377,530,584,530,642,1542,
  377,530,584,530,644,1557,
  377,530,584,530,646,1570,
  377,530,584,530,647,1581,
  377,530,584,530,649,1594,
  377,530,584,530,649,1605,
  377,530,584,530,649,1616,
  377,530,585,530,651,1627,
  377,530,586,530,652,1638,
  377,530,588,530,655,1650,
  378,530,592,530,656,1661,
  377,530,594,530,658,1672,
  377,530,596,530,659,1684,
  377,530,597,530,660,1696,
  377,530,597,530,661,1708,
  377,530,597,530,661,1720,
  377,530,597,530,661,1732,
  377,530,598,530,661,1746,
  377,530,598,530,661,1760,
  377,530,598,530,661,1774,
  377,530,599,530,662,1789,
  377,530,599,530,663,1804,
  377,530,602,530,664,1822,
  377,530,603,530,664,1839,
  377,530,606,530,666,1856,
  377,530,610,530,667,1873,
  377,530,616,530,668,1885,
  377,530,621,530,671,1897,
  377,530,625,530,671,1908,
  377,530,626,530,672,1919,
  377,530,627,530,672,1931,
  377,530,627,530,672,1942,
  377,530,628,530,672,1955,
  377,530,628,530,672,1967,
  377,530,628,530,672,1980,
  377,530,628,530,672,1996,
  377,530,629,530,672,2008,
  376,530,631,530,672,2019,
  377,530,631,530,672,2030,
  377,530,631,530,672,2041,
  377,530,629,530,672,2052,
  377,530,628,530,672,2063,
  377,530,627,530,672,2075,
  377,530,627,530,672,2086,
  377,530,627,530,672,2097,
  377,530,627,530,672,2108,
  377,530,626,523,672,2119,
  377,530,614,517,672,2127,
  377,530,603,512,672,2134,
  377,530,595,508,672,2145,
  377,530,596,508,668,2156,
  377,530,597,508,667,2167,
  377,530,600,508,667,2178,
  377,530,600,508,664,2189,
  377,530,603,508,664,2200,
  377,530,601,501,664,2211,
  377,530,594,496,664,2222,
  377,530,588,492,664,2233,
  377,530,581,488,664,2244,
  377,530,579,488,664,2255,
  377,530,579,488,664,2266,
  377,530,573,488,658,2277,
  377,530,571,488,656,2288,
  377,530,569,486,653,2299,
  377,530,562,474,653,2308,
  377,531,555,463,653,2316,
  377,531,547,451,653,2325,
  376,531,537,440,653,2325,
  377,531,528,429,653,2325,
  377,531,519,418,653,2324,
  377,531,508,408,653,2318,
  377,531,500,397,653,2314,
  377,530,489,389,653,2306,
  377,530,478,380,649,2300,
  377,530,468,369,646,2295,
  377,530,457,365,641,2290,
  377,530,452,354,639,2284,
  377,530,441,346,633,2277,
  377,530,430,341,629,2276,
  377,530,419,338,628,2275,
  377,530,408,330,626,2278,
  377,530,419,335,629,2280,
500,530,419,335,629,2280,
500,530,424,335,629,2266,
500,530,413,335,629,2263,
500,530,410,335,629,2274,
500,530,398,335,629,2279,
500,530,394,335,629,2290,
500,529,398,346,630,2283,
500,529,409,354,630,2283,
500,529,420,362,630,2283,
500,529,431,370,630,2284,
500,529,442,375,630,2284,
500,529,454,381,630,2284,
500,530,465,385,630,2284,
500,530,476,388,629,2284,
500,530,474,398,618,2280,
500,530,473,402,611,2291,
500,529,466,411,600,2294,
500,530,477,412,597,2296,
500,530,474,401,597,2303,
500,530,463,394,597,2310,
500,529,465,391,597,2299,
377,529,469,402,602,2299,
377,529,470,413,602,2300,
377,529,480,424,602,2301,
377,529,491,435,602,2301,
377,529,502,443,605,2300,
377,529,513,449,608,2300,
377,529,518,459,608,2312,
377,529,518,462,608,2323,
377,529,519,467,608,2334,
377,529,519,469,608,2346,
377,529,519,470,608,2358,
377,529,519,472,608,2369,
377,529,519,474,608,2381,
377,529,519,476,608,2393,
377,529,519,477,608,2408,
377,530,519,478,608,2419,
377,529,519,478,608,2433,
377,529,519,478,608,2448,
377,529,519,478,608,2465,
377,529,519,478,608,2480,
377,529,520,478,608,2500,
377,529,520,478,608,2517,
377,529,520,478,608,2535,
377,529,520,478,608,2552,
377,529,520,478,608,2569,
377,529,520,478,607,2585,
377,529,520,478,607,2600,
377,529,520,477,607,2616,
377,529,520,477,605,2629,
377,529,520,476,602,2641,
377,529,516,474,601,2653,
377,529,509,472,596,2664,
377,529,498,470,592,2674,
377,529,489,467,587,2685,
377,529,478,462,583,2696,
377,529,465,455,578,2705,
377,529,453,449,575,2711,
377,530,442,443,571,2714,
377,529,431,437,569,2717,
377,529,420,427,565,2719,
377,529,409,417,561,2719,
377,529,398,411,556,2718,
377,529,386,405,549,2722,
377,529,375,399,544,2729,
377,529,364,398,538,2737,
377,529,352,394,531,2748,
377,529,343,391,524,2759,
377,529,336,388,518,2770,
377,529,325,385,507,2779,
377,529,314,382,499,2785,
377,529,303,381,492,2789,
377,528,292,380,482,2796,
377,528,281,378,473,2804,
377,528,271,378,461,2812,
377,528,262,378,450,2822,
377,528,254,378,439,2828,
377,528,242,378,429,2833,
377,528,231,378,417,2832,
377,528,222,378,406,2828,
377,528,214,378,394,2825,
377,528,207,378,381,2826,
377,528,203,378,370,2828,
377,528,196,378,359,2827,
377,528,192,378,348,2824,
377,528,189,385,337,2830,
377,528,187,391,326,2839,
377,528,184,398,315,2844,
377,528,184,409,308,2849,
377,528,180,420,298,2842,
377,526,169,422,292,2842,
377,524,158,424,288,2842,

};

uint16_t profile3[]=
{
// 377,521,176,449,283,2822,
// 377,521,187,449,287,2831,
// 377,521,195,449,298,2832,
// 377,521,205,449,309,2835,
// 377,521,216,449,320,2840,
// 377,521,225,449,331,2842,
// 377,521,237,449,342,2849,
// 377,521,249,449,352,2856,
// 377,521,260,449,362,2861,
// 377,521,272,449,373,2866,
// 377,521,281,449,384,2868,
// 377,521,292,449,393,2871,
// 377,521,303,449,404,2878,
// 377,521,314,449,415,2888,
// 377,521,324,449,423,2899,
// 377,521,332,449,430,2911,
// 377,521,340,449,437,2922,
// 377,521,345,450,442,2933,
// 377,521,351,450,449,2944,
// 377,521,354,450,451,2955,
// 377,521,355,450,453,2967,
// 377,521,356,450,456,2979,
// 377,521,358,450,458,2991,
// 377,521,360,450,460,3002,
// 377,521,363,450,465,3014,
// 377,521,364,450,465,3026,
// 377,521,366,450,466,3037,
// 377,521,366,450,466,3048,
// 377,521,367,450,466,3060,
// 377,521,367,450,466,3071,
// 377,521,367,450,466,3082,
// 377,520,367,450,466,3093,
// 377,521,368,450,466,3104,
// 377,521,368,450,466,3115,
// 377,521,368,450,466,3127,
// 377,521,368,450,466,3138,
// 377,521,368,450,466,3149,
// 377,521,368,450,466,3160,
// 377,521,368,450,465,3171,
// 377,521,368,450,460,3182,
// 377,520,368,450,449,3192,
// 377,520,360,450,438,3192,
// 377,521,355,450,430,3203,
// 377,521,356,462,426,3202,
// 377,521,359,473,419,3207,
// 377,520,360,479,414,3196,
// 376,510,349,459,416,3214,
// 376,510,349,459,416,3203,
// 365,512,348,459,416,3197,
// 354,511,348,459,416,3197,
// 343,511,348,457,416,3197,
// 332,511,345,457,416,3197,
// 70,511,358,473,416,3189,
// 70,510,358,473,427,3187,
// 70,513,363,473,436,3183,
// 70,514,375,473,446,3185,
// 70,514,386,473,449,3185,
// 70,517,395,473,460,3186,
// 70,519,406,473,467,3181,
// 70,519,414,473,478,3179,
// 70,519,425,474,482,3179,
// 70,519,436,478,492,3174,
// 70,519,447,483,499,3163,
// 70,519,452,487,501,3152,
// 70,519,455,489,505,3141,
// 70,519,458,490,508,3130,
// 70,519,458,490,512,3118,
// 70,519,458,490,512,3107,
// 70,519,458,490,512,3096,
// 70,518,458,490,512,3085,
// 70,518,458,490,512,3074,
// 70,518,458,490,512,3062,
// 70,518,458,490,512,3050,
// 70,518,458,490,512,3039,
// 70,518,458,490,512,3026,
// 70,518,459,490,512,3013,
// 70,518,458,490,512,3002,
// 70,519,458,490,512,2990,
// 70,518,459,490,512,2979,
// 70,518,459,490,512,2967,
// 70,518,458,490,513,2953,
// 70,518,459,490,513,2939,
// 70,519,458,490,512,2925,
// 70,518,458,490,513,2913,
// 70,519,458,490,513,2900,
// 70,518,458,490,513,2889,
// 70,518,458,490,513,2876,
// 70,518,458,490,513,2865,
// 70,518,458,490,513,2842,
// 70,518,459,491,513,2831,
// 70,518,458,491,513,2818,
// 70,518,458,491,513,2806,
// 70,518,459,491,513,2795,
// 70,518,470,491,521,2789,
// 70,518,484,491,525,2783,
// 70,518,496,491,529,2772,
// 70,519,505,494,540,2763,
// 70,519,513,505,544,2750,
// 70,519,517,509,545,2739,
// 70,519,521,517,546,2728,
// 70,519,525,527,546,2717,
// 70,519,532,535,546,2706,
// 70,519,538,542,546,2695,
// 70,518,544,547,547,2684,
// 70,518,549,550,549,2673,
// 70,518,551,550,553,2661,
// 70,518,555,550,556,2649,
// 70,518,556,550,559,2638,
// 70,518,557,550,563,2626,
// 70,518,557,550,565,2613,
// 70,517,559,550,568,2602,
// 70,517,559,550,570,2590,
// 70,517,561,550,573,2579,
// 70,517,565,550,575,2568,
// 70,517,567,550,578,2556,
// 70,516,569,550,579,2544,
// 70,517,568,551,581,2531,
// 70,517,570,551,583,2520,
// 70,517,571,551,583,2509,
// 70,516,574,551,586,2498,
// 70,516,576,551,589,2487,
// 70,516,577,551,590,2476,
// 70,516,580,551,593,2465,
// 70,516,581,551,594,2454,
// 70,516,582,551,596,2443,
// 70,516,583,551,596,2432,
// 70,516,583,551,597,2421,
// 70,516,584,551,598,2410,
// 70,516,585,551,599,2399,
// 70,516,586,551,599,2388,
// 70,516,587,551,600,2377,
// 70,516,592,551,603,2366,
// 70,516,594,551,603,2355,
// 70,516,598,548,605,2344,
// 70,516,599,547,605,2333,
// 70,516,601,547,605,2322,
// 70,516,609,547,606,2311,
// 70,516,616,539,610,2300,
// 70,516,619,528,611,2295,
// 70,516,618,517,614,2296,
// 70,516,616,506,619,2297,
// 70,517,608,495,621,2297,
// 70,517,597,487,621,2298,
// 70,517,590,476,621,2298,
// 70,517,583,465,622,2299,
// 70,517,574,454,622,2299,
// 70,517,567,443,622,2295,
// 70,519,556,435,622,2297,
// 150,519,556,435,622,2297,
// 150,519,576,449,622,2300,
// 150,519,585,460,624,2298,
// 150,519,586,471,622,2293,
// 150,519,590,482,622,2291,
// 150,519,595,493,622,2298,
// 150,519,595,502,622,2309,
// 150,519,596,506,622,2320,
// 150,519,596,508,622,2331,
// 150,519,597,509,622,2343,
// 150,519,597,511,622,2354,
// 150,519,597,511,622,2365,
// 150,519,597,512,622,2376,
// 150,519,597,513,622,2387,
// 150,519,597,517,622,2398,
// 150,519,597,520,622,2409,
// 150,519,597,520,622,2420,
// 150,519,597,521,622,2432,
// 150,519,597,524,622,2444,
// 150,519,599,527,622,2455,
// 150,519,602,531,622,2467,
// 150,520,603,533,622,2478,
// 150,520,604,535,622,2489,
// 150,520,606,538,622,2500,
// 150,520,608,540,622,2511,
// 150,520,613,543,622,2522,
// 150,520,619,545,622,2534,
// 150,520,622,548,622,2545,
// 150,520,626,551,622,2556,
// 150,520,631,552,622,2568,
// 150,520,633,555,622,2579,
// 150,520,636,555,622,2590,
// 150,520,636,558,622,2601,
// 150,520,639,559,622,2613,
// 150,520,641,560,622,2624,
// 150,520,642,562,622,2635,
// 150,520,645,564,622,2648,
// 150,520,647,565,622,2664,
// 150,520,650,566,622,2676,
// 150,520,651,567,621,2687,
// 150,520,651,568,620,2698,
// 150,520,651,569,618,2711,
// 150,520,651,571,617,2726,
// 150,520,651,575,614,2746,
// 150,520,651,577,612,2765,
// 150,520,652,581,610,2780,
// 150,520,652,582,609,2791,
// 150,520,652,585,607,2803,
// 150,520,652,587,605,2818,
// 150,520,652,589,603,2833,
// 150,520,651,590,602,2846,
// 150,520,650,591,600,2857,
// 150,520,649,591,597,2869,
// 150,520,645,591,596,2881,
// 150,520,644,591,593,2892,
// 150,520,642,591,591,2903,
// 150,520,639,591,589,2914,
// 150,520,637,591,586,2926,
// 150,520,636,591,583,2938,
// 150,520,635,591,579,2950,
// 150,520,634,591,575,2961,
// 150,520,631,591,572,2972,
// 150,520,628,591,569,2983,
// 150,520,627,591,565,2995,
// 150,520,624,591,563,3006,
// 150,520,619,591,558,3019,
// 150,520,619,591,556,3030,
// 150,520,616,591,551,3043,
// 150,520,612,591,549,3055,
// 150,520,608,591,547,3066,
// 150,520,608,591,543,3078,
// 150,519,607,592,541,3089,
// 150,519,606,594,538,3101,
// 150,519,605,596,534,3112,
// 150,519,602,600,531,3126,
// 150,519,603,602,528,3138,
// 150,519,603,606,522,3149,
// 150,519,602,613,515,3160,
// 150,519,600,616,508,3171,
// 150,519,597,617,501,3182,
// 150,519,590,617,490,3188,
// 150,519,587,616,479,3188,
// 150,519,583,605,475,3191,
// 150,520,566,584,476,3193,
// 150,520,577,594,475,3193,
// 150,520,558,573,478,3194,
// 150,520,547,564,479,3195,
// 150,520,537,552,483,3198,
// 150,520,527,541,484,3199,
// 150,520,516,531,485,3199,
// 150,520,505,523,485,3200,
// 150,520,494,517,485,3200,
// 150,520,483,507,485,3201,
// 150,520,472,501,485,3201,
// 150,520,461,495,481,3200,
// 150,520,453,495,470,3199,
// 150,520,442,488,465,3199,
// 150,520,431,482,465,3199,
// 150,520,419,478,456,3203,
// 150,520,408,471,450,3203,
// 150,520,397,466,445,3200,
// 150,520,386,461,442,3199,
// 150,520,378,461,431,3192,
// 70,513,368,462,423,3197,
// 150,513,368,462,423,3197,
// 70,513,368,462,423,3197,
// 200,513,368,462,423,3197,
// 200,513,379,462,423,3192,
// 200,515,377,468,434,3185,
// 200,517,388,468,440,3185,
// 200,519,382,468,445,3174,
// 200,519,375,468,445,3163,
// 200,520,370,473,445,3138,
// 200,519,371,471,445,3151,
// 200,520,370,476,450,3127,
// 200,520,372,478,452,3116,
// 200,521,378,479,452,3104,
// 200,521,381,480,453,3092,
// 200,521,383,483,454,3079,
// 200,521,385,483,454,3067,
// 200,521,385,483,454,3054,
// 200,521,385,484,454,3041,
// 200,521,385,485,454,3029,
// 200,521,385,486,454,3018,
// 200,521,383,487,454,3006,
// 200,521,385,488,454,2995,
// 200,521,385,489,452,2984,
// 200,521,385,491,449,2973,
// 200,521,385,493,445,2962,
// 200,521,381,494,439,2951,
// 200,521,375,496,431,2940,
// 200,520,366,496,424,2929,
// 200,520,357,496,413,2920,
// 200,519,350,497,402,2913,
// 200,520,341,497,391,2905,
// 200,520,334,497,379,2898,
// 200,521,326,497,370,2887,
// 200,521,322,497,359,2880,
// 200,520,318,497,348,2871,
// 200,519,311,497,337,2863,
// 200,519,306,498,326,2854,
// 200,519,304,498,315,2847,
// 200,519,306,498,312,2858,
// 200,519,295,498,306,2865,
// 200,518,284,498,301,2864,
// 200,519,273,498,298,2864,
// 200,519,262,498,295,2866,
// 200,519,251,498,290,2866,
// 200,519,240,498,287,2868
198,517,239,506,279,2867,
209,516,239,506,279,2868,
220,516,239,506,279,2867,
231,516,239,506,279,2867,
242,516,239,506,279,2867,
253,516,239,506,279,2868,
264,516,239,506,279,2867,
275,516,239,506,279,2867,
286,515,239,506,279,2867,
286,517,227,506,279,2869,
285,517,239,506,289,2869,
285,517,250,506,298,2867,
285,517,261,506,304,2862,
285,516,272,506,312,2859,
285,516,283,506,321,2858,
285,516,293,506,333,2858,
285,516,304,506,343,2859,
285,516,316,506,352,2858,
285,516,327,506,362,2860,
285,516,339,506,370,2865,
285,516,350,506,379,2871,
285,516,363,506,388,2880,
285,516,375,506,398,2889,
285,516,386,506,403,2898,
285,516,397,505,412,2907,
285,516,408,502,421,2914,
285,516,418,498,430,2925,
285,516,425,493,437,2937,
285,516,431,484,448,2948,
285,516,432,478,455,2960,
285,516,436,470,466,2972,
285,517,439,463,477,2983,
285,515,439,458,484,2994,
285,516,441,455,486,3005,
285,516,442,449,493,3016,
285,516,442,447,495,3028,
285,516,442,444,499,3040,
285,516,442,441,502,3051,
285,516,442,438,505,3062,
285,516,443,435,509,3074,
285,517,445,432,515,3085,
285,517,448,430,520,3096,
285,517,451,429,524,3107,
285,517,455,427,529,3118,
285,517,457,427,529,3130,
285,517,457,427,529,3141,
285,517,457,427,529,3152,
285,517,453,427,529,3163,
285,517,445,427,529,3174,
285,517,442,427,528,3185,
285,517,442,427,528,3196,
285,518,442,427,522,3207,
285,518,431,427,515,3215,
285,517,419,427,506,3216,
286,516,406,427,501,3216,
285,515,395,427,493,3216,
285,515,383,427,483,3215,
286,513,372,427,474,3214,
286,511,367,432,463,3214,
286,511,366,438,452,3208,
286,511,366,449,442,3205,
286,511,367,460,436,3206,
286,511,367,471,428,3205,
285,511,360,473,417,3206,
286,511,349,471,412,3206,
275,511,350,471,412,3204,
264,512,350,471,412,3204,
253,511,350,471,412,3204,
242,511,350,471,412,3204,
231,511,349,471,412,3203,
220,511,350,471,412,3203,
209,511,350,471,412,3203,
198,511,350,471,412,3202,
187,511,349,471,412,3202,
176,511,350,471,412,3201,
165,511,350,471,412,3201,
154,511,350,471,412,3201,
143,511,350,471,412,3201,
132,511,350,470,412,3201,
121,511,349,470,412,3202,
109,511,350,470,412,3203,
98,511,349,470,412,3203,
87,511,349,470,412,3203,
76,511,349,470,412,3203,
65,511,348,470,412,3203,
54,511,348,470,412,3203,
51,511,359,474,414,3199,
51,511,370,479,416,3198,
51,511,381,483,422,3195,
51,512,393,487,424,3194,
51,512,404,493,430,3195,
51,512,415,500,431,3194,
52,512,426,506,431,3193,
52,512,437,511,432,3193,
51,512,448,516,437,3192,
52,512,459,523,438,3191,
51,511,470,531,438,3190,
51,511,481,535,440,3189,
52,511,492,544,442,3188,
51,511,500,555,442,3187,
51,511,511,563,442,3187,
52,511,522,573,442,3187,
51,511,532,584,442,3189,
51,511,540,595,442,3189,
51,511,551,604,442,3189,
51,511,561,616,442,3189,
51,511,570,627,442,3188,
51,511,581,638,442,3189,
51,511,592,649,442,3189,
51,511,601,660,442,3190,
51,511,613,670,442,3190,
51,511,624,681,442,3190,
51,511,635,691,442,3187,
51,511,643,702,442,3185,
51,511,652,713,442,3180,
51,511,660,724,442,3172,
52,511,669,735,442,3166,
51,511,674,738,442,3155,
51,511,684,749,442,3148,
51,511,695,759,442,3152,
51,511,707,765,442,3152,
51,511,712,774,442,3163,
51,512,711,771,453,3171,
51,512,711,760,460,3177,
51,512,705,749,465,3179,
51,512,697,738,471,3178,
51,512,689,727,478,3177,
51,512,689,716,486,3178,
51,512,688,705,494,3178,
51,512,685,694,502,3177,
51,512,685,684,513,3176,
51,512,683,673,522,3177,
51,512,680,662,532,3172,
52,511,678,651,539,3165,
51,511,678,644,545,3153,
51,511,678,639,549,3142,
51,512,678,634,555,3131,
51,512,678,626,564,3120,
52,512,678,624,569,3109,
51,512,678,620,572,3098,
51,512,678,618,575,3087,
51,512,678,616,578,3075,
51,512,678,613,579,3064,
51,512,678,613,581,3051,
51,511,678,613,583,3040,
51,511,678,613,583,3027,
51,511,678,613,583,3013,
51,511,678,613,583,2999,
51,511,678,613,583,2985,
51,511,678,613,583,2972,
51,511,678,613,583,2957,
52,511,678,613,583,2945,
51,511,678,613,583,2933,
51,511,678,613,583,2922,
51,511,678,613,583,2911,
51,511,678,613,583,2899,
51,511,678,613,583,2888,
51,511,678,613,583,2877,
51,511,678,613,583,2866,
52,511,678,613,583,2855,
51,511,678,614,583,2844,
51,511,678,617,583,2833,
51,511,678,618,583,2822,
51,511,678,619,583,2811,
51,511,678,619,583,2799,
52,512,678,619,583,2788,
51,512,678,619,583,2777,
51,512,678,619,583,2766,
51,512,678,619,583,2755,
51,511,677,619,583,2741,
51,512,677,619,583,2727,
51,512,678,619,583,2716,
51,512,678,619,583,2705,
51,513,677,619,583,2694,
51,513,678,619,583,2683,
51,513,677,619,583,2671,
51,513,678,619,583,2660,
51,513,677,619,584,2649,
51,512,678,619,585,2638,
51,513,678,618,589,2625,
51,513,678,618,592,2610,
52,512,677,618,594,2596,
51,512,678,617,597,2584,
51,512,677,613,600,2573,
51,512,677,613,601,2562,
51,512,677,613,602,2551,
51,512,677,613,602,2540,
51,512,677,613,602,2528,
51,512,678,613,602,2517,
51,512,677,613,602,2506,
51,512,677,613,602,2493,
52,512,677,612,602,2481,
51,511,677,611,602,2470,
51,511,677,611,602,2459,
51,511,677,611,602,2448,
51,511,677,611,602,2437,
52,511,677,611,602,2426,
51,511,677,611,602,2414,
51,511,677,611,602,2403,
51,511,677,611,601,2392,
51,511,677,611,598,2381,
51,511,677,611,596,2370,
51,512,677,611,585,2361,
51,511,677,603,575,2350,
51,511,677,596,575,2339,
51,511,666,589,576,2336,
51,511,652,582,578,2336,
51,512,639,572,579,2335,
51,511,627,562,581,2335,
51,511,616,553,583,2335,
51,511,605,542,586,2335,
51,511,611,535,597,2329,
51,511,619,526,601,2318,
51,510,611,515,603,2313,
51,510,611,504,603,2314,
51,510,611,493,603,2314,
51,510,599,485,603,2314,
51,510,588,480,603,2314,
51,510,577,471,603,2314,
51,510,585,462,614,2316,
51,510,582,451,622,2322,
51,510,571,444,622,2322,
51,510,560,436,622,2323,
52,510,555,425,622,2320,
51,507,544,419,622,2321,
150,507,544,419,622,2321,
150,516,510,398,622,2289,
150,516,512,398,622,2300,
159,516,514,409,622,2306,
159,516,525,415,622,2305,
159,516,536,425,622,2306,
159,516,547,432,622,2304,
159,516,554,443,622,2300,
159,516,561,454,622,2294,
159,516,568,465,622,2291,
159,516,579,472,622,2288,
159,516,585,483,622,2287,
159,516,594,494,622,2287,
159,516,600,505,622,2289,
159,516,606,510,622,2300,
159,516,608,512,622,2312,
159,516,608,512,622,2323,
159,516,608,512,622,2334,
159,516,608,512,622,2345,
159,516,608,512,622,2356,
159,516,608,512,622,2367,
159,517,606,512,622,2378,
159,516,606,512,622,2389,
159,516,606,512,622,2400,
159,517,606,512,622,2411,
159,517,606,512,622,2422,
159,516,606,512,622,2433,
159,517,606,512,622,2444,
159,516,606,512,622,2455,
159,516,606,512,622,2466,
159,516,606,511,622,2477,
159,517,606,509,622,2488,
159,517,606,509,622,2499,
159,517,606,506,622,2510,
159,517,606,506,622,2521,
159,517,606,506,622,2532,
159,516,606,506,622,2543,
159,516,606,506,622,2554,
159,516,606,506,622,2565,
159,516,605,506,622,2577,
159,516,605,506,622,2588,
159,516,606,506,622,2599,
159,516,606,506,622,2611,
159,516,606,506,622,2625,
159,516,606,506,622,2638,
159,516,606,506,622,2650,
159,516,606,506,622,2661,
159,516,606,506,622,2672,
159,517,606,506,622,2683,
159,517,606,506,622,2694,
159,517,606,506,622,2706,
159,516,606,506,622,2717,
159,516,606,506,622,2728,
159,516,606,506,622,2740,
159,516,606,506,622,2752,
159,516,606,506,622,2763,
159,516,606,506,622,2774,
159,516,606,506,622,2785,
159,516,606,506,622,2797,
150,516,606,506,622,2808,
159,516,606,506,622,2819,
159,516,606,506,622,2830,
159,516,606,506,622,2841,
159,516,606,506,622,2852,
159,516,606,506,622,2863,
159,516,606,506,622,2874,
159,516,606,506,622,2885,
159,516,606,506,622,2897,
159,516,606,506,622,2908,
159,516,606,506,622,2920,
159,516,606,506,622,2931,
159,515,606,506,621,2943,
159,516,606,506,621,2955,
159,516,606,506,619,2966,
159,516,606,506,619,2977,
159,516,606,506,618,2989,
159,516,606,506,618,3000,
159,516,606,506,617,3011,
159,517,606,506,616,3022,
159,516,606,506,614,3033,
159,516,606,506,612,3044,
159,516,605,506,610,3055,
159,516,602,506,609,3066,
159,516,602,506,606,3077,
159,516,590,506,603,3087,
159,516,578,506,601,3090,
159,516,567,506,596,3098,
159,516,560,506,586,3110,
159,516,554,506,580,3121,
159,516,543,506,575,3130,
159,516,537,506,569,3141,
159,516,536,506,566,3152,
159,516,533,506,565,3163,
159,515,532,506,564,3174,
159,516,521,506,553,3183,
159,515,514,506,542,3192,
159,515,503,506,532,3200,
159,515,498,515,521,3201,
159,515,498,520,510,3200,
159,515,491,523,499,3203,
159,515,487,523,488,3205,
159,515,484,523,477,3205,
159,515,489,526,466,3205,
159,515,484,527,455,3207,
159,515,473,518,454,3212,
159,516,462,510,454,3213,
159,515,450,501,454,3215,
159,515,439,493,452,3215,
159,515,428,492,445,3216,
159,515,417,484,445,3216,
159,515,406,483,436,3213,
159,515,395,480,430,3208,
159,515,383,476,428,3206,
159,515,372,474,420,3203,
159,515,360,470,419,3199,
109,514,356,468,416,3192,
120,512,357,468,416,3192,
131,511,357,468,416,3192,
142,511,357,468,416,3190,
153,511,357,468,416,3189,
164,511,357,468,416,3189,
175,511,357,468,416,3189,
186,510,357,468,416,3187,
198,510,357,468,416,3186,
209,510,358,468,416,3186,
409,511,357,465,416,3197,
409,511,370,468,424,3196,
409,511,381,468,430,3196,
409,511,387,479,435,3194,
409,511,398,489,436,3191,
409,511,405,500,436,3187,
409,511,415,512,436,3181,
409,511,426,522,436,3177,
409,511,437,523,445,3176,
409,511,448,523,452,3175,
409,511,454,524,463,3168,
409,511,465,525,472,3163,
409,511,476,533,475,3155,
409,511,485,540,478,3144,
409,511,489,545,482,3133,
409,511,491,550,484,3122,
409,511,491,551,486,3111,
409,511,491,551,487,3100,
409,510,491,551,487,3089,
409,510,491,551,487,3078,
409,510,491,550,487,3067,
409,510,489,550,487,3056,
409,510,488,548,487,3044,
409,510,485,546,487,3033,
409,510,481,544,485,3020,
409,510,475,540,484,3007,
409,510,469,535,484,2995,
409,510,462,531,483,2984,
409,510,455,525,482,2972,
409,510,450,520,479,2961,
409,510,445,516,477,2950,
409,510,439,509,473,2939,
409,510,429,504,466,2928,
409,510,418,498,460,2919,
409,509,406,495,454,2912,
409,508,395,493,443,2906,
409,508,385,489,435,2895,
409,508,380,488,428,2884,
409,508,372,486,416,2876,
409,508,360,486,409,2872,
409,508,349,486,401,2867,
409,508,337,486,391,2860,
409,508,336,486,378,2852,
409,508,331,486,367,2845,
409,508,320,486,358,2837,
409,508,312,485,347,2833,
409,508,305,485,336,2828,
409,508,294,485,326,2824,
409,508,283,485,319,2817,
409,508,274,485,308,2816,
409,508,263,485,300,2815,
409,508,252,486,296,2812,
409,509,241,486,289,2808,
409,510,230,488,287,2806,

};
void curPos_cb(const std_msgs::UInt16MultiArray::ConstPtr& array);
// void goalPos_cb(const std_msgs::UInt16MultiArray::ConstPtr& array);
void armProfile_cb(const std_msgs::UInt16::ConstPtr& idx);
void drillState_cb(const std_msgs::UInt8::ConstPtr& state);
// void servoState_cb(const std_msgs::UInt8::ConstPtr& state);
void mainTasks();
void runArm();
bool readyToAdvance();
void runArmState();


uint16_t curPos[6] = {0,0,0,0,0,0};
uint16_t goalPos[6] = {0,0,0,0,0,0};
uint16_t armProfile_idx = 0;
uint16_t step = 0;
uint8_t drillState = 0;
uint8_t servoState = 0;
bool profileInited = false;
bool profile2Inited = false;
bool profile3Inited = false;
bool profileCompleted = false;

std_msgs::UInt16MultiArray goalPos_ros;
std_msgs::Char command_ros;
int main(int argc, char **argv)
{
  ros::init(argc, argv, "handler");
  /* start cyclic part */
  ros::NodeHandle n;
  ros::Publisher goalPos_pub = n.advertise<std_msgs::UInt16MultiArray>("armGoalPos", 100);
  //ros::Publisher command_pub = n.advertise<std_msgs::Char>("trailerCommand",1000);
  ros::Subscriber curPos_sub = n.subscribe("armCurPos", 100, curPos_cb);
  ros::Subscriber armProfile_sub = n.subscribe("armProfile_idx", 100, armProfile_cb);
  ros::Subscriber drillState_sub = n.subscribe("drillState", 100, drillState_cb);
  // ros::Subscriber servoState_sub = n.subscribe("servoState", 100, servoState_cb);
  // ros::Subscriber goalPos_sub = n.subscribe("dxlGoalPos", 100, goalPos_cb);

  ros::Rate loop_rate(100);

  // command_ros.data = 'p';


  while(ros::ok())
  {
    mainTasks();
    //command_pub.publish(command_ros);
    goalPos_pub.publish(goalPos_ros);
    ros::spinOnce();
    loop_rate.sleep();
  }
  return 0;
}
void mainTasks()
{
  runArmState();
  goalPos_ros.data.clear();
  for (int i = 0; i < 6; i++)
  {
    goalPos_ros.data.push_back(goalPos[i]);
  }

}
void runArmState()
{
  switch(armProfile_idx)
  {
    case 0:
      step = 0;
      profileInited = false;
    break;
    case 1:
      ROS_INFO("running profile 1");
      if(step < PROFILE1LENGTH)
      {
        if(!profileInited)
        {
          for (int i = 0; i < 6; i++)
          {
            goalPos[i] = profile1[i];
            profileInited = true;
          }
        }
        if(readyToAdvance())
        {
         
          // ROS_INFO("advanced to next step");
          
          for (int i = 0; i < 6; i++)
          {
            goalPos[i] = profile1[(i)+step*6];
          }
          step++;
        }
      }
      else
      {
        for (int i = 0; i < 6; i++)
        {
          goalPos[i] = 0;
        }
        armProfile_idx = 0;
      }
    break;
    case 2:
      ROS_INFO("running profile 2");
      if(step < PROFILE2LENGTH)
      {
        if(!profileInited)
        {
          for (int i = 0; i < 6; i++)
          {
            goalPos[i] = profile2[i];
            profileInited = true;
          }
        }
        if(readyToAdvance())
        {

          //  ROS_INFO("advanced to next step");
          
          for (int i = 0; i < 6; i++)
          {
            goalPos[i] = profile2[(i)+step*6];
          }
          step++;
        }
      }
      else
      {
        for (int i = 0; i < 6; i++)
        {
          goalPos[i] = 0;
        }
        armProfile_idx = 0;
      }
    break;
    case 3:
      ROS_INFO("Case 3");

      if(step < PROFILE3LENGTH)
      {
        if(!profileInited)
        {
          for (int i = 0; i < 6; i++)
          {
            goalPos[i] = profile3[i];
            profileInited = true;
          }
        }
        if(readyToAdvance())
        {
          // ROS_INFO("advanced to next step");
          
          for (int i = 0; i < 6; i++)
          {
            goalPos[i] = profile3[(i)+step*6];
          }
          step++;
        }
      }
      else
      {
        for (int i = 0; i < 6; i++)
        {
          goalPos[i] = 0;
        }
        armProfile_idx = 0;
      }
    break;
  }
}
void runArm()
{
  // ROS_INFO("profile: %d", armProfile_idx);
  if (armProfile_idx == 0)
  {
    for (int i = 0; i < 6; i++)
    {
      goalPos[i] = 0;
    }
  }
  else if (armProfile_idx == 1)
  {
    if(profileInited && !profileCompleted)
    {

      if(step < PROFILE1LENGTH)
      {
        if(readyToAdvance())
        {
          // ROS_INFO("advanced to next step");
          step++;
          for (int i = 0; i < 6; i++)
          {
            goalPos[i] = profile1[(i)+step*6];
          }
        }
      }
      else
      {
        for (int i = 0; i < 6; i++)
        {
          goalPos[i] = 0;
        }
        profileCompleted = true;
        profileInited = false;
      }
    }
    else
    {
      step = 0;
      for (int i = 0; i < 6; i++)
      {
        goalPos[i] = profile1[(i)];
      }
      profileInited = true;
      profileCompleted = false;
    }
  }
  else if (armProfile_idx == 2)
  {
    if(profile2Inited)
    {

      if(step < PROFILE2LENGTH)
      {
        if(readyToAdvance())
        {
          // ROS_INFO("advanced to next step");
          step++;
          for (int i = 0; i < 6; i++)
          {
            goalPos[i] = profile2[(i)+step*6];
          }
        }
      }
      else
      {
        for (int i = 0; i < 6; i++)
        {
          goalPos[i] = 0;
        }
      }
    }
    else
    {
      step = 0;
      for (int i = 0; i < 6; i++)
      {
        goalPos[i] = profile2[i];
      }
      profile2Inited = true;
    }
  }
  else if (armProfile_idx ==3)
  {

      if(profile3Inited)
      {

        if(step < PROFILE3LENGTH)
        {
          if(readyToAdvance())
          {
            // ROS_INFO("advanced to next step");
            step++;
            for (int i = 0; i < 6; i++)
            {
              goalPos[i] = profile3[(i)+step*6];
            }
          }
        }
        else
        {
          for (int i = 0; i < 6; i++)
          {
            goalPos[i] = 0;
          }
        }
      }
      else
      {
        step = 0;
        for (int i = 0; i < 6; i++)
        {
          goalPos[i] = profile3[i];
        }
        profile3Inited = true;
      }
    }

}
bool readyToAdvance()
{
  for (int i = 0; i < 6; i++)
  {
    int error = abs(curPos[i] - goalPos[i]);
    // ROS_INFO("error: %d", error);
    // ROS_INFO("curpos4: %d", curPos[4]);
    if (error > MOTIONTH)
    {
      return 0;
    }
  }
  return 1;
}
void curPos_cb(const std_msgs::UInt16MultiArray::ConstPtr& array)
{
  for (int i = 0; i < 6; i++)
  {
    curPos[i] = (uint16_t)(array->data[i]);
  }
}
void armProfile_cb(const std_msgs::UInt16::ConstPtr& idx)
{
  armProfile_idx = idx->data;
  ROS_INFO("armProfile: %d", armProfile_idx);
}
void drillState_cb(const std_msgs::UInt8::ConstPtr& state)
{
  drillState = state->data;
  ROS_INFO("drillState: %d", drillState);
}
// void servoState_cb(const std_msgs::UInt8::ConstPtr& state)
// {
//   servoState = state->data;
//   ROS_INFO("servoState: %d", servoState);
// }
// void goalPos_cb(const std_msgs::UInt16MultiArray::ConstPtr& array)
// {
//   for (int i = 0; i < 4; i++)
//   {
//     goalPos[i] = (uint16_t)array->data[i];
//   }
// }
